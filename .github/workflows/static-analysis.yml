name: Static Analysis Reusable Workflow

on:
  workflow_call:
    inputs:
      python-versions:
        default: '[3.10]'
        type: string
      requirements-txt:
        default: null
        type: string
      build-command:
        default: null
        type: string
      run-pylint:
        default: true
        type: boolean
      pylint-version:
        default: null
        type: string
      pylint-args:
        default: null
        type: string
      run-mypy:
        default: true
        type: boolean
      mypy-version:
        default: null
        type: string
      mypy-args:
        default: null
        type: string

jobs:
  pylint:
    if: ${{ github.event_name == 'push' || github.event_name == 'pull_request' }}
    name: pylint
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ${{ fromJSON(inputs.python-versions) }}
    steps:
      - name: Run pylint
        uses: GenapsysInc/internal-actions/reusable-actions/pylint@main
        with:
          python-version: ${{ matrix.python-version }}
          requirements-txt: ${{ inputs.requirements-txt }}
          build-command: ${{ inputs.build-command }}
          pylint-version: ${{ inputs.pylint-version }}
          args: ${{ inputs.pylint-args }}
  mypy:
    if: ${{ github.event_name == 'push' || github.event_name == 'pull_request' }}
    name: mypy
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ${{ inputs.python-versions }}
    steps:
      - name: Run mypy
        uses: GenapsysInc/internal-actions/reusable-actions/mypy@main
        with:
          python-version: ${{ matrix.python-version }}
          requirements-txt: ${{ inputs.requirements-txt }}
          build-command: ${{ inputs.build-command }}
          mypy-version: ${{ inputs.mypy-version }}
          args: ${{ inputs.mypy-args }}
